---
title: static关键字
categories:
  - []
tags:
  - null
date: 2020-06-29 00:25:02
---

<!--more-->

本文仅对static修饰全局变量、全局函数、局部变量进行介绍，并不对static修饰类成员变量、成员函数内容进行介绍。

## 1
一句话，使用static的目的就是为了“实现文件隔离”。

文件隔离是什么？考虑以下情况：
- A、B两个人合伙写一个项目；
- A负责一个模块a.cpp, B负责另外一个模块b.cpp;
- A、B两个人都喜欢声明 x 这个变量，它们都在自己的模块中声明了一个全局变量 x ；
- A、B完成自己各自的模块后，进行合并，将所有模块链接到一块时，出现了多重定义（multiple definition）问题；
- 如何解决这个问题呢？其中一个人把变量名改一下，是个办法，但到底叫谁改呢：叫A改，A不高兴；叫B改，B不高兴；
- 再进一步考虑下，假设m个人负责m个不同模块，它们都比较喜欢x、y、z...等n个变量名，并且都在自己模块中定义了这些全局变量；
- 显然最后肯定也会出现多重定义问题，那这个时候该怎么解决，还是用上面那个方法？可行是可行，但对程序员来说真的是一场灾难；
- 这也就是引入static的动机；

分析以上问题：
- 其实每个人需要的并不是一些全局变量，他们要的只是“文件范围内”的变量；

```
//a.cpp
int x = 100;

//b.cpp
int x = 100;

//main.cpp
#include <iostream>

int main() {
    std::cout << "hello world" << std::endl;
    return 0;
}
```
使用以下命令编译时，会出现多重定义（multiple definition）问题
```
g++ -g main.cpp a.cpp b.cpp -o main
```

解决方案
```C++
//a.cpp
static int x = 100;

//b.cpp
static int x = 100;

//main.cpp
#include <iostream>

int main() {
    std::cout << "hello world" << std::endl;
    return 0;
}
```

## 2 静态全局变量与静态局部变量

|     |静态全局变量|静态局部变量|
|:-:|:-:|:-:|
定义|被static修饰的全局变量|被static修饰的局部变量|
存储区域|全局区（未初始化时，值为0）|全局区（未初始化时，值为0）
作用域|当前文件|当前块
生命周期|与主程序一样，随程序的销毁而销毁|与主程序一样，随程序的销毁而销毁

## 3 问题
可以使用extern导出静态全局变量吗？
- 可以导出，而且当不使用extern导出的静态全局变量时，编译器不会报错，但是这样做完全没有意义（导出了，但又不能用，导出它干嘛？）。

静态全局变量的声明和定义能不能放到头文件中，而不是源文件中？
- 理论上是可以的，但最好不要放在头文件中;
- 理由有很多，慢慢想；


