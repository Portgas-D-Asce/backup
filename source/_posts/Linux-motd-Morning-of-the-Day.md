---
title: Linux motd(Morning of the Day)
author: Portgas·D·Asce
categories:
  - [Ubuntu]
tags:
  - Just for Fun
date: 2020-12-05 21:26:45
---

<!--more-->
先对环境介绍下：
- 服务器系统：阿里云 ECS Ubuntu 20.04 LTS；
- 本机系统：Ubuntu 20.04 LTS；
- 本机终端：Gnome Terminal；

## 1 去除默认 motd
### 1.1 相关内容
原是的 motd 一般长下面这个样子：
```
Welcome to use Ubuntu 20.04 LTS (x86_64 xxxxxxxxxxxx)
    * xxxxxxxx
    * xxxxxxxx
    * xxxxxxxx

Welcome to use aliyun ecs xxxxx.

Last login: xxx xxx  x xx:xx:xx xxxx from xxx.xxx.xxx.xxx.
```

motd 由两部分内容组成：
- 静态部分；
- 动态生成部分；

相关文件及目录
- **/etc/motd:** motd 静态内容存放的地方；
- **/etc/update-motd.d:** 生成 motd 动态内容所需要用到的东西都会放在该目录下；
- /etc/pam.d/login: 什么都不用改，但确实是跟 motd 是有关的；
- /run/motd.dynamic: 不用修改，也跟 motd 有关；
- **/etc/ssh/sshd_config.d:** 实际上这个跟 motd 没关系，就是一个 ssh 的配置；

/etc/update-motd.d 目录下有以下内容：
- 00-header;
- 10-help-text;
- 50-motd-news;
- 91-release-upgrade;

/etc/pam.d/login 文件有以下内容：
```
# Prints the message of the day upon successful login.
# (Replaces the `MOTD_FILE' option in login.defs)
# This includes a dynamically generated part from /run/motd.dynamic
# and a static (admin-editable) part from /etc/motd.
session    optional   pam_motd.so motd=/run/motd.dynamic
session    optional   pam_motd.so noupdate
```

大概意思就是:
- 一个脚本会根据 /etc/update-motd.d/ 目录下的文件动态生成 motd 的动态部分；
- 所生成的内容会放到 /run/motd.dynamic 这个文件中；
- 而 motd 动态部分显示的就是 /run/motd.dynamic 文件中的内容；
- 最后 /etc/motd 中的 静态内容会被追加到动态内容的后面；

### 1.2 删除 motd
要做的就是两点：
- 删除 motd 的静态部分: 这个简单，将 /etc/motd 文件内容清空或者直接把该文件删除即可；
- 删除 motd 的动态部分: 
  - 删除 /run/motd.dynamic 这个文件中的内容是不行了，因为它是动态生成的，删了它还会重新生成；
  - 可以将 00-header 和 10-help-text 中的内容都注释掉，使得生成的内容为空，自然也就看不见 默认生成的 motd 了；

### 1.3 disabled lastlog
做完以上工作，重新登录到云主机上，发现还有一个 lastlog 内容还在：
```
Last login: xxx xxx  x xx:xx:xx xxxx from xxx.xxx.xxx.xxx
```
这个内容不归 motd 管，归 ssh 管：
- 先进入并打开 /etc/ssh/sshd_config 文件；
- 找到 PrintLastLog , 取消前面的注释，并将其设置为 no；
- 保存并退出，但还没完，有一个重要的步骤：sudo service ssh restart，重启 ssh 服务；

至此，从本地登录到云主机后，所有提示信息都已经消失了，下面再说如何来自定义自己的 motd；

## 2 自定义 motd
### 2.1 终端上显示图片
网上找到资料都是 Ascii image 相关内容，能不能将图片直接显示在终端上呢？一开始是有尝试在终端上显示图片的，试着用了 w3m, neofetch 这些，折腾了好久才发现 gnome terminal 不支持图片显示，又不想换终端，只能放弃。

### 2.2 终端上显示 Emoji
无意间发现 Emoji （通过使用其 Ascii 码）可以显示在 gnome terminal 上的，例如：
```
printf "\U1f618\n"

//或

echo -e "\U1f618"
```
可以到下面网站查找 Emoji 的 Ascii
- [EMOJI中文网](https://www.emojiall.com/zh-hans)；

### 2.3 获取天气信息
参考以下网站
- [wttr.in](https://github.com/chubin/wttr.in)

```
curl "wttr.in/London?format=%l:+%C+%t\n"
```

### 2.3 实现
最后在老版 Ascii image 的基础上，加上 Emoji 实现了自定义的 motd（耳濡目染，好可怕:），效果如下：
{% asset_img 1.png%}

怎么实现呢？很简单：
- 先在服务器 /etc/profile.d/ 目录下新建一个 motd.sh 文件；
- 再将以下代码复制进去即可；

```
weather=`curl -s "wttr.in/北京?format=%l:+%C+%t+%h+%P"`
day=`date +"%Y-%m-%d %H:%M:%S"`
echo -e "\033[31m${weather} \033[0m   \t\t\t  \033[32m当前时间: ${day} \033[0m"

printf "
                     .::::.
                   .::::::::.
                  :::::::::::
               ..:::::::::::'                                    题三十计小象
            '::::::::::::'     \033[5m\U1f618\033[0m
              .::::::::::
         '::::::::::::::..                                           清·悔余生诗·吴庆坻
              ..::::::::::::.
            \`\`::::::::::::::::
             ::::\`\`:::::::::'        .:::.               须知少时凌云志，曾许人间第一流。
            ::::'   ':::::'       .::::::::.
          .::::'      ::::     .:::::::'::::.
         .:::'       :::::  .:::::::::' ':::::.          哪晓岁月蹉跎过，依旧名利两无收。
        .::'        :::::.:::::::::'      ':::::.
       .::'         ::::::::::::::'         ``::::.
   ...:::           ::::::::::::'              ``::.
  \`\`\`\` ':.          ':::::::::'                  ::::..
                     '.:::::'                    ':'\`\`\`\`..\n\n"

user=`whoami`
cnt=`last | cut -d ' ' -f 1 | grep ${user} | wc -l`
last=`last | grep ${user} | grep -v "still logged in" | head -1 | cut -d '(' -f 2 | cut -d ')' -f -1`
printf "\033[32m亲爱的 ${user}, 我们最近约会了 ${cnt} 次 \U1f493 \U1f493\033[0m   \t\t  \033[31m最后一次约会长达: ${last} \U1f60D \U1f60D\033[0m\n\n"
```


### 3 Ascii Images
搜集到的一些 Ascii Images
```
                   _ooOoo_
                  o8888888o
                  88" . "88
                  (| -_- |)
                  O\  =  /O
               ____/`---'\____
             .'  \\|     |//  `.
            /  \\|||  :  |||//  \
           /  _||||| -:- |||||-  \
           |   | \\\  -  /// |   |
           | \_|  ''\---/''  |   |
           \  .-\__  `-`  ___/-. /
         ___`. .'  /--.--\  `. . __
      ."" '<  `.___\_<|>_/___.'  >'"".
     | | :  `- \`.;`\ _ /`;.`/ - ` : | |
     \  \ `-.   \_ __\ /__ _/   .-` /  /
======`-.____`-.___\_____/___.-`____.-'======
                   `=---='
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


                   .::::.
                 .::::::::.
                :::::::::::
             ..:::::::::::'
          '::::::::::::'
            .::::::::::
       '::::::::::::::..
            ..::::::::::::.
          ``::::::::::::::::
           ::::``:::::::::'        .:::.
          ::::'   ':::::'       .::::::::.
        .::::'      ::::     .:::::::'::::.
       .:::'       :::::  .:::::::::' ':::::.
      .::'        :::::.:::::::::'      ':::::.
     .::'         ::::::::::::::'         ``::::.
 ...:::           ::::::::::::'              ``::.
```` ':.          ':::::::::'                  ::::..
                   '.:::::'                    ':'````..



              ,----------------,              ,---------,
         ,-----------------------,          ,"        ,"|
       ,"                      ,"|        ,"        ,"  |
      +-----------------------+  |      ,"        ,"    |
      |  .-----------------.  |  |     +---------+      |
      |  |                 |  |  |     | -==----'|      |
      |  |  I LOVE DOS!    |  |  |     |         |      |
      |  |  Bad command or |  |  |/----|`---=    |      |
      |  |  C:\>_          |  |  |   ,/|==== ooo |      ;
      |  |                 |  |  |  // |(((( [33]|    ,"
      |  `-----------------'  |," .;'| |((((     |  ,"
      +-----------------------+  ;;  | |         |,"
         /_)______________(_/  //'   | +---------+
    ___________________________/___  `,
   /  oooooooooooooooo  .o.  oooo /,   \,"-----------
  / ==ooooooooooooooo==.o.  ooo= //   ,`\--{)B     ,"
 /_==__==========__==_ooo__ooo=_/'   /___________,"




                 .-~~~~~~~~~-._       _.-~~~~~~~~~-.
             __.'              ~.   .~              `.__
           .'//                  \./                  \\`.
         .'//                     |                     \\`.
       .'// .-~"""""""~~~~-._     |     _,-~~~~"""""""~-. \\`.
     .'//.-"                 `-.  |  .-'                 "-.\\`.
   .'//______.============-..   \ | /   ..-============.______\\`.
 .'______________________________\|/______________________________`.



  .--,       .--,
 ( (  \.---./  ) )
  '.__/o   o\__.'
     {=  ^  =}
      >  -  <
     /       \
    //       \\
   //|   .   |\\
   "'\       /'"_.-~^`'-.
      \  _  /--'         `
    ___)( )(___
   (((__) (__)))


     .=""=.
    / _  _ \
   |  d  b  |          
   \   /\   /                
  ,/'-=\/=-'\,       
 / /        \ \  
| /          \ | 
\/ \        / \/ 
    '.    .'     
    _|`~~`|_     
    /|\  /|\ 


┌───┐   ┌───┬───┬───┬───┐ ┌───┬───┬───┬───┐ ┌───┬───┬───┬───┐ ┌───┬───┬───┐
│Esc│   │ F1│ F2│ F3│ F4│ │ F5│ F6│ F7│ F8│ │ F9│F10│F11│F12│ │P/S│S L│P/B│  ┌┐    ┌┐    ┌┐
└───┘   └───┴───┴───┴───┘ └───┴───┴───┴───┘ └───┴───┴───┴───┘ └───┴───┴───┘  └┘    └┘    └┘
┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───────┐ ┌───┬───┬───┐ ┌───┬───┬───┬───┐
│~ `│! 1│@ 2│# 3│$ 4│% 5│^ 6│& 7│* 8│( 9│) 0│_ -│+ =│ BacSp │ │Ins│Hom│PUp│ │N L│ / │ * │ - │
├───┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─────┤ ├───┼───┼───┤ ├───┼───┼───┼───┤
│ Tab │ Q │ W │ E │ R │ T │ Y │ U │ I │ O │ P │{ [│} ]│ | \ │ │Del│End│PDn│ │ 7 │ 8 │ 9 │   │
├─────┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴─────┤ └───┴───┴───┘ ├───┼───┼───┤ + │
│ Caps │ A │ S │ D │ F │ G │ H │ J │ K │ L │: ;│" '│ Enter  │               │ 4 │ 5 │ 6 │   │
├──────┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴────────┤     ┌───┐     ├───┼───┼───┼───┤
│ Shift  │ Z │ X │ C │ V │ B │ N │ M │< ,│> .│? /│  Shift   │     │ ↑ │     │ 1 │ 2 │ 3 │   │
├─────┬──┴─┬─┴──┬┴───┴───┴───┴───┴───┴──┬┴───┼───┴┬────┬────┤ ┌───┼───┼───┐ ├───┴───┼───┤ E││
│ Ctrl│    │Alt │         Space         │ Alt│    │    │Ctrl│ │ ← │ ↓ │ → │ │   0   │ . │←─┘│
└─────┴────┴────┴───────────────────────┴────┴────┴────┴────┘ └───┴───┴───┘ └───────┴───┴───┘



         ┌─┐       ┌─┐
      ┌──┘ ┴───────┘ ┴──┐
      │                 │
      │       ───       │
      │  ─┬┘       └┬─  │
      │                 │
      │       ─┴─       │
      │                 │
      └───┐         ┌───┘
          │         │
          │         │
          │         │
          │         └──────────────┐
          │                        │
          │                        ├─┐
          │                        ┌─┘
          │                        │
          └─┐  ┐  ┌───────┬──┐  ┌──┘
            │ ─┤ ─┤       │ ─┤ ─┤
            └──┴──┘       └──┴──┘



                  ___====-_  _-====___
            _--^^^#####//      \\#####^^^--_
         _-^##########// (    ) \\##########^-_
        -############//  |\^^/|  \\############-
      _/############//   (@::@)   \\############\_
     /#############((     \\//     ))#############\
    -###############\\    (oo)    //###############-
   -#################\\  / VV \  //#################-
  -###################\\/      \//###################-
 _#/|##########/\######(   /\   )######/\##########|\#_
 |/ |#/\#/\#/\/  \#/\##\  |  |  /##/\#/  \/\#/\#/\#| \|
 `  |/  V  V  `   V  \#\| |  | |/#/  V   '  V  V  \|  '
    `   `  `      `   / | |  | | \   '      '  '   '
                     (  | |  | |  )
                    __\ | |  | | /__
                   (vvv(VVV)(VVV)vvv)




                      _.._        ,------------.
                   ,'      `.    (I want you! )
                  /  __) __` \    `-,----------'
                 (  (`-`(-')  ) _.-'
                 /)  \  = /  (
                /'    |--' .  \
               (  ,---|  `-.)__`
                )(  `-.,--'   _`-.
               '/,'          (  Uu",
                (_       ,    `/,-' )
                `.__,  : `-'/  /`--'
                  |     `--'  |
                  `   `-._   /
                   \        (
                   /\ .      \.  
                  / |` \     ,-\
                 /  \| .)   /   \
                ( ,'|\    ,'     :
                | \,`.`--"/      }
                `,'    \  |,'    /
               / "-._   `-/      |
               "-.   "-.,'|     ;
              /        _/["---'""]
             :        /  |"-     '
             '           |      /
                         `      |
```

## 参考
- [How can I remove the ssh last login info?
](https://superuser.com/questions/443986/how-can-i-remove-the-ssh-last-login-info)
- [Customize your MOTD login message in Debian and Ubuntu](https://ownyourbits.com/2017/04/05/customize-your-motd-login-message-in-debian-and-ubuntu/)
- [Create a Custom MOTD or Login Banner in Linux](https://www.youtube.com/watch?v=K7Dnwu4Frgc&list=PLNIIXOYNmDDaNHmNiZFSS6004x_4e6yOR&index=1)